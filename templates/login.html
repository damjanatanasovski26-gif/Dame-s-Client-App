{% extends "base.html" %}
{% set title = "Login | Trainer App" %}
{% set page_class = "page-login" %}

{% block content %}
<div class="login-split">
  <section class="auth-visual auth-visual-full" style="--auth-photo:url('{{ url_for('static', filename='images/coach.png') }}');">
    <div class="auth-visual-inner">
      <h2 class="auth-title">Train. Track. Improve.</h2>
      <p class="muted" style="max-width:30ch;">
        Keep progress, sessions, and payment status in one clean system.
      </p>
      <div class="auth-metrics">
        <div class="auth-chip">Sessions</div>
        <div class="auth-chip">Progress</div>
        <div class="auth-chip">Consistency</div>
      </div>
      <div class="auth-socials">
        <a class="auth-social" href="https://instagram.com/" target="_blank" rel="noopener noreferrer">Instagram</a>
        <a class="auth-social" href="https://tiktok.com/" target="_blank" rel="noopener noreferrer">TikTok</a>
        <a class="auth-social" href="https://youtube.com/" target="_blank" rel="noopener noreferrer">YouTube</a>
      </div>
    </div>
  </section>

  <section class="login-panel">
    <div class="login-panel-inner">
      <div class="login-card">
        <h2 class="auth-title">Client Login</h2>
        <p class="muted" style="margin-top:0;">Enter your username and password.</p>

        {% if err %}
          <div class="alert error" style="margin-top:12px;">
            <b style="color:var(--danger);">Error:</b>
            {% if lock_seconds %}
              Too many attempts. Try again in <span id="lock-seconds" data-seconds="{{ lock_seconds }}">{{ lock_seconds }}</span>s.
            {% else %}
              {{ err }}
            {% endif %}
          </div>
        {% endif %}

        <form class="form" action="{{ url_for('login') }}" method="POST">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <label class="label">Username</label>
          <input class="input" name="username" autocomplete="username" required {% if lock_seconds %}disabled{% endif %}>

          <label class="label">Password</label>
          <div class="password-wrap">
            <input id="loginPassword" class="input" type="password" name="password" autocomplete="current-password" required {% if lock_seconds %}disabled{% endif %}>
            <button
              id="loginPasswordToggle"
              class="password-toggle"
              type="button"
              data-password-target="loginPassword"
              aria-label="Show password"
              aria-pressed="false"
              {% if lock_seconds %}disabled{% endif %}
            >&#128065;</button>
          </div>

          <button class="btn" type="submit" style="margin-top:6px;" {% if lock_seconds %}disabled{% endif %}>Log in</button>
        </form>

        <div class="muted auth-foot">
          If you do not have credentials, ask your coach.
        </div>
      </div>
    </div>
  </section>
</div>
<script>
  (function () {
    const el = document.getElementById("lock-seconds");
    if (!el) return;
    const form = el.closest(".login-card")?.querySelector("form");
    const fields = form ? form.querySelectorAll("input[name='username'], input[name='password'], button[type='submit'], #loginPasswordToggle") : [];
    let seconds = Number(el.dataset.seconds || 0);
    if (!Number.isFinite(seconds) || seconds <= 0) return;
    const timer = setInterval(() => {
      seconds -= 1;
      if (seconds <= 0) {
        el.textContent = "0";
        fields.forEach((field) => { field.disabled = false; });
        clearInterval(timer);
        return;
      }
      el.textContent = String(seconds);
    }, 1000);
  })();
</script>
{% endblock %}
