<div class="card">
  <h3>Sessions</h3>

  <div class="muted" style="margin-bottom:10px;">
    This week: <b>{{ used_this_week }}</b> / <b>{{ allowed }}</b>
    (Remaining: <b>{{ remaining }}</b>)
  </div>

  <form id="logSessionForm" class="form" action="{{ url_for('add_session', client_id=client.id) }}" method="POST" style="max-width:520px;">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input class="input" name="note" placeholder="Optional note (Push / Pull / Rehab)">
    <button class="btn" type="submit">Log Session</button>
  </form>
</div>

<div class="card">
  <h3>Session Calendar - {{ session_calendar.month_name }} {{ session_calendar.year }}</h3>
  <div class="session-calendar">
    {% for label in session_calendar.weekday_labels %}
      <div class="session-calendar-head">{{ label }}</div>
    {% endfor %}
    {% for cell in session_calendar.cells %}
      <div class="session-calendar-cell {% if cell.is_today %}today{% endif %} {% if cell.count > 0 %}has-session{% endif %}">
        {% if cell.day %}
          <div class="session-calendar-day">{{ cell.day }}</div>
          {% if cell.count > 0 %}
            <div class="session-calendar-count">{{ cell.count }} session{% if cell.count != 1 %}s{% endif %}</div>
          {% else %}
            <div class="session-calendar-empty">-</div>
          {% endif %}
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>

<div class="card">
  <h3>Recent Sessions</h3>

  {% if sessions %}
    <div class="table-wrap">
      <table>
        <tr>
          <th>Date</th>
          <th>Note</th>
          <th></th>
        </tr>
        {% for s in sessions %}
        <tr>
          <td>{{ s.date.strftime("%d/%m/%Y %H:%M") }}</td>
          <td>{{ s.note or "-" }}</td>
          <td style="text-align:right;">
            {% if is_admin %}
              <form action="{{ url_for('delete_session', client_id=client.id, session_id=s.id) }}"
                    method="POST"
                    onsubmit="return confirm('Delete this session?');"
                    style="margin:0;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button class="btn danger" type="submit">Delete</button>
              </form>
            {% else %}
              -
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </table>
    </div>
  {% else %}
    <div class="empty-state">No sessions logged yet.</div>
  {% endif %}
</div>
